name: Main branch CI

on:
  push:
    branches:
      - main

env:
  node-version: 20
  pnpm-version: 10
  frontend-cache-dependency-path: frontend/pnpm-lock.yaml
  backend-cache-dependency-path: backend/pnpm-lock.yaml

jobs:
  frontend-ci:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - uses: ./.github/actions/setup-node-pnpm
        with:
          node-version: ${{ env.node-version }}
          pnpm-version: ${{ env.pnpm-version }}
          cache-dependency-path: ${{ env.frontend-cache-dependency-path }}

      - name: Install frontend dependencies
        working-directory: frontend
        run: |-
          pnpm install && \
          echo "ğŸŒ¥ï¸ Installed dependencies"
      - name: Check lint
        working-directory: frontend
        run: |-
          pnpm lint && \
          echo "â›…ï¸ Passed the lint check"
      - name: Check type
        working-directory: frontend
        run: |-
          pnpm tsc && \
          echo "ğŸŒ¤ï¸ Passed the type check"
      - name: Test
        working-directory: frontend
        run: |-
          pnpm test && \
          echo "â˜€ï¸ Passed the tests"

  backend-ci:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - uses: ./.github/actions/setup-node-pnpm
        with:
          node-version: ${{ env.node-version }}
          pnpm-version: ${{ env.pnpm-version }}
          cache-dependency-path: ${{ env.backend-cache-dependency-path }}
      - name: Install backend dependencies
        working-directory: backend
        run: |-
          pnpm install && \
          echo "â›…ï¸ Installed dependencies"

      - name: Check type
        working-directory: backend
        run: |-
          pnpm tsc && \
          echo "â˜€ï¸ Passed the type check"
